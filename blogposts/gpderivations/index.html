<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/bayesiantribulations/libs/katex/katex.min.css"> <link rel=stylesheet  href="/bayesiantribulations/libs/highlight/github.min.css"> <link rel=stylesheet  href="/bayesiantribulations/css/franklin.css"> <link rel=stylesheet  href="/bayesiantribulations/css/poole_hyde.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 768px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/bayesiantribulations/assets/favicon.png"> <title>Gaussian Process Important derivations</title> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <h1><a href="/bayesiantribulations/">Bayesian Tribulations</a></h1> <p class=lead >Unexpected computational events!</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/bayesiantribulations/">Home</a> <a class="sidebar-nav-item active" href="/bayesiantribulations/blogposts/">Blog Posts</a> <a class="sidebar-nav-item " href="/bayesiantribulations/publications/">Publications</a> </nav> <p>&copy; Théo Galy-Fajou.</p> </div> </div> <div class="content container"> <div class=franklin-content > <h1 id=gaussian_process_important_derivations ><a href="#gaussian_process_important_derivations" class=header-anchor >Gaussian Process important derivations</a></h1> <p><div class=franklin-toc ><ol><li><a href="#gaussian_process_important_derivations">Gaussian Process important derivations</a><ol><li><ol><li><a href="#derivatives_kl_divergence_given_variational_parameters">Derivatives KL Divergence given variational parameters</a><ol><li><a href="#gradients">Gradients</a><li><a href="#hessians">Hessians</a></ol></ol></ol></ol></div> </p> \[ \text{KL}(q||p) = \frac{1}{2}\left[\log|K| - \log|\Sigma| - d + \text{tr} (K^{-1}\Sigma) + (\mu_0 - \mu)^T K^{-1}(\mu_0 - \mu)\right]. \] <pre><code class=language-julia >using KernelFunctions, LinearAlgebra, ForwardDiff, Plots, LaTeXStrings
D &#61; 3
μ &#61; randn&#40;D&#41;
μ₀ &#61; randn&#40;D&#41;
Σ &#61; rand&#40;D, D&#41; |&gt; x -&gt; x * x&#39; &#43; I # Positive definite matrix
K &#61; rand&#40;D, D&#41; |&gt; x-&gt; x * x&#39; &#43; I
L &#61; cholesky&#40;Σ&#41;.L # Cholesky of the covariance Σ
KL&#40;μ, Σ::Matrix, μ₀ ,K&#41; &#61;
	0.5*&#40;logdet&#40;K&#41; - logdet&#40;Σ&#41; - length&#40;μ&#41; &#43;
		tr&#40;inv&#40;K&#41; * Σ&#41; &#43; &#40;μ₀ - μ&#41;&#39; * inv&#40;K&#41; * &#40;μ₀ - μ&#41;&#41;
@show KL&#40;μ,Σ,μ₀,K&#41;</code></pre> <pre><code class="plaintext code-output">KL(μ, Σ, μ₀, K) = 3.167850463946593
</code></pre> <p>When using instead \(L\) where \(LL^\top = \Sigma\).</p> \[\begin{aligned} \text{KL}(q||p) = \frac{1}{2}\left[\log|K| - 2 \log|L| - d + \text{tr} (L^\top K^{-1}L) + (\mu_0 - \mu)^T K^{-1}(\mu_0 - \mu)\right]. \end{aligned}\] <pre><code class=language-julia >L &#61; cholesky&#40;Σ&#41;.L
KL&#40;μ, L::LowerTriangular, μ₀, K&#41; &#61;
 	0.5*&#40;logdet&#40;K&#41; - 2logdet&#40;L&#41; - length&#40;μ&#41; &#43;
			tr&#40;L&#39; * inv&#40;K&#41; * L&#41; &#43; &#40;μ₀ - μ&#41;&#39; * inv&#40;K&#41; * &#40;μ₀-μ&#41;&#41;
@show KL&#40;μ,L,μ₀,K&#41;</code></pre> <pre><code class="plaintext code-output">KL(μ, L, μ₀, K) = 3.167850463946593
</code></pre> <h3 id=derivatives_kl_divergence_given_variational_parameters ><a href="#derivatives_kl_divergence_given_variational_parameters" class=header-anchor >Derivatives KL Divergence given variational parameters</a></h3> <h4 id=gradients ><a href="#gradients" class=header-anchor >Gradients</a></h4> <p>Gradients given \(\mu,\Sigma,L\):</p> \[\begin{aligned} \frac{d\text{KL}}{d\mu} =& K^{-1}(\mu-\mu_0)\\ \frac{d\text{KL}}{d\Sigma} =& \frac{1}{2}\left(-\Sigma^{-1} + K^{-1}\right)\\ \frac{d\text{KL}}{dL} =& \frac{1}{2}\left(-2\text{diag}(L)^{-1} + 2K^{-1}L\right) \end{aligned}\] <pre><code class=language-julia >dKL_dμ&#40;K, μ, μ₀&#41; &#61; inv&#40;K&#41; * &#40;μ - μ₀&#41; # Analytic Formulation
analytic &#61; dKL_dμ&#40;K, μ, μ₀&#41;
autodiff &#61; ForwardDiff.gradient&#40;μ&#41; do x
	KL&#40;x, Σ, μ₀, K&#41;
end</code></pre> <p> <img src="/bayesiantribulations/assets/blogposts/gpderivations/code/output/dKLdmu.svg" alt=""></p> <pre><code class=language-julia >dKL_dΣ&#40;K, Σ&#41; &#61; 0.5 * &#40;-inv&#40;Σ&#41; &#43; inv&#40;K&#41;&#41;
analytic &#61; dKL_dΣ&#40;K, Σ&#41;
autodiff &#61; ForwardDiff.gradient&#40;Σ&#41; do x
	KL&#40;μ, x, μ₀, K&#41;
end</code></pre> <img src="/bayesiantribulations/assets/blogposts/gpderivations/code/output/dKLdSigma.svg" alt=""> <pre><code class=language-julia >dKL_dL&#40;K, L&#41; &#61;
	LowerTriangular&#40;0.5 * &#40;-2 * inv&#40;Diagonal&#40;Matrix&#40;L&#41;&#41;&#41; &#43; 2 * inv&#40;K&#41; * L&#41;&#41;
analytic &#61; dKL_dL&#40;K, L&#41;
autodiff &#61; ForwardDiff.gradient&#40;L&#41; do x
	KL&#40;μ, x, μ₀, K&#41;
end</code></pre> <img src="/bayesiantribulations/assets/blogposts/gpderivations/code/output/dKLdL.svg" alt=""> <h4 id=hessians ><a href="#hessians" class=header-anchor >Hessians</a></h4> <p>Hessian given \(\mu,\Sigma,L\):</p> \[\begin{aligned} \frac{d^2KL}{d\mu\mu} =& K^{-1}\\ \frac{d^2KL}{d\mu d\Sigma} =& 0\\ \frac{d^2KL}{d\Sigma\Sigma} =& \frac{1}{2} \Sigma^{-1}\otimes \Sigma^{-1}\\ \frac{d^2KL}{d\mu dL} =& 0\\ \frac{d^2KL}{dLL} =& - \text{diag} L^{-1}\otimes L^{-1} + K\otimes I \end{aligned}\] <p>Where \(\otimes\) is the outer-product<br/></p> <pre><code class=language-julia >d2KL_dμμ&#40;K&#41; &#61; inv&#40;K&#41;
analytic &#61; d2KL_dμμ&#40;K&#41;
autodiff &#61; ForwardDiff.hessian&#40;μ&#41; do x
	KL&#40;x, Σ, μ₀, K&#41;
end</code></pre> <img src="/bayesiantribulations/assets/blogposts/gpderivations/code/output/d2KLdmumu.svg" alt=""> <pre><code class=language-julia >d2KL_dSS&#40;Σ&#41; &#61; 0.5 * kron&#40;inv&#40;Σ&#41;, inv&#40;Σ&#41;&#41;
analytic &#61; d2KL_dSS&#40;Σ&#41;
autodiff &#61; ForwardDiff.hessian&#40;Σ&#41; do x
	KL&#40;μ, x, μ₀, K&#41;
end</code></pre> <img src="/bayesiantribulations/assets/blogposts/gpderivations/code/output/d2KLdSigmaSigma.svg" alt=""> <div class=page-foot > <div class=copyright > &copy; Théo Galy-Fajou. Last modified: August 27, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>. </div> </div> </div> </div> <script src="/bayesiantribulations/libs/katex/katex.min.js"></script> <script src="/bayesiantribulations/libs/katex/auto-render.min.js"></script> <script>renderMathInElement(document.body)</script> <script src="/bayesiantribulations/libs/highlight/highlight.pack.js"></script> <script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: ' '});</script> <script src="https://utteranc.es/client.js" repo="theogf/bayesiantribulations" issue-term=title  label="[Comments]" theme=github-light  crossorigin=anonymous  async> </script>