<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/bayesiantribulations/libs/katex/katex.min.css"> <link rel=stylesheet  href="/bayesiantribulations/libs/highlight/github.min.css"> <link rel=stylesheet  href="/bayesiantribulations/css/franklin.css"> <link rel=stylesheet  href="/bayesiantribulations/css/poole_hyde.css"> <style> html {font-size: 17px;} .franklin-content {position: relative; padding-left: 8%; padding-right: 5%; line-height: 1.35em;} @media (min-width: 940px) { .franklin-content {width: 100%; margin-left: auto; margin-right: auto;} } @media (max-width: 768px) { .franklin-content {padding-left: 6%; padding-right: 6%;} } </style> <link rel=icon  href="/bayesiantribulations/assets/favicon.png"> <title>Gaussian Process Important derivations</title> <div class=sidebar > <div class="container sidebar-sticky"> <div class=sidebar-about > <h1><a href="/bayesiantribulations/">Bayesian Tribulations</a></h1> <p class=lead >Unexpected computational events!</p> </div> <nav class=sidebar-nav > <a class="sidebar-nav-item " href="/bayesiantribulations/">Home</a> <a class="sidebar-nav-item active" href="/bayesiantribulations/blogposts/">Blog Posts</a> <a class="sidebar-nav-item " href="/bayesiantribulations/publications/">Publications</a> </nav> <p>&copy; Théo Galy-Fajou.</p> </div> </div> <div class="content container"> <div class=franklin-content ><h1 id=gaussian_process_important_derivations ><a href="#gaussian_process_important_derivations">Gaussian Process important derivations</a></h1> <p><div class=franklin-toc ><ol><li><a href="#gaussian_process_important_derivations">Gaussian Process important derivations</a><ol><li><ol><li><a href="#derivatives_kl_divergence_given_variational_parameters">Derivatives KL Divergence given variational parameters</a><ol><li><a href="#gradients">Gradients</a><li><a href="#hessians">Hessians</a></ol></ol></ol></ol></div> </p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>KL</mtext><mo stretchy=false >(</mo><mi>q</mi><mi mathvariant=normal >∣</mi><mi mathvariant=normal >∣</mi><mi>p</mi><mo stretchy=false >)</mo><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo fence=true >[</mo><mi>log</mi><mo>⁡</mo><mi mathvariant=normal >∣</mi><mi>K</mi><mi mathvariant=normal >∣</mi><mo>−</mo><mi>log</mi><mo>⁡</mo><mi mathvariant=normal >∣</mi><mi mathvariant=normal >Σ</mi><mi mathvariant=normal >∣</mi><mo>−</mo><mi>d</mi><mo>+</mo><mtext>tr</mtext><mo stretchy=false >(</mo><msup><mi>K</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi mathvariant=normal >Σ</mi><mo stretchy=false >)</mo><mo>+</mo><mo stretchy=false >(</mo><msub><mi>μ</mi><mn>0</mn></msub><mo>−</mo><mi>μ</mi><msup><mo stretchy=false >)</mo><mi>T</mi></msup><msup><mi>K</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >(</mo><msub><mi>μ</mi><mn>0</mn></msub><mo>−</mo><mi>μ</mi><mo stretchy=false >)</mo><mo fence=true >]</mo></mrow><mi mathvariant=normal >.</mi></mrow><annotation encoding="application/x-tex"> \text{KL}(q||p) = \frac{1}{2}\left[\log|K| - \log|\Sigma| - d + \text{tr} (K^{-1}\Sigma) + (\mu_0 - \mu)^T K^{-1}(\mu_0 - \mu)\right]. </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:1em;vertical-align:-0.25em;"></span><span class="mord text"><span class=mord >KL</span></span><span class=mopen >(</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class=mord >∣</span><span class=mord >∣</span><span class="mord mathdefault">p</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:2.00744em;vertical-align:-0.686em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class=mop >lo<span style="margin-right:0.01389em;">g</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >∣</span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class=mord >∣</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mop >lo<span style="margin-right:0.01389em;">g</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >∣</span><span class=mord >Σ</span><span class=mord >∣</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">d</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class=mord >tr</span></span><span class=mopen >(</span><span class=mord ><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mord >Σ</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathdefault">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">μ</span><span class=mclose ><span class=mclose >)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathdefault">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">μ</span><span class=mclose >)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >.</span></span></span></span></span> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> KernelFunctions, LinearAlgebra, ForwardDiff, Plots, LaTeXStrings
D = <span class=hljs-number >3</span>
μ = randn(D)
μ₀ = randn(D)
Σ = rand(D, D) |&gt; x-&gt;x*x&#x27; <span class=hljs-comment ># Positive definite matrix</span>
K = rand(D, D) |&gt; x-&gt;x*x&#x27;
L = cholesky(Σ).L
KL(μ, Σ::<span class=hljs-built_in >Matrix</span>, μ₀ ,K) =
	<span class=hljs-number >0.5</span>*(logdet(K) - logdet(Σ) - length(μ) +
		tr(inv(K) * Σ) + (μ₀ - μ)&#x27; * inv(K) * (μ₀ - μ))
<span class=hljs-meta >@show</span> KL(μ,Σ,μ₀,K)</code></pre> <pre><code class="plaintext hljs">WARNING: SqExponentialKernel changed convention in version 0.8.0.
This kernel now divides the squared distance by 2 to align with standard practice.
This warning will be removed in 0.9.0.
KL(μ, Σ, μ₀, K) = 252.0629478989621
</code></pre> <p>When using instead <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault">L</span></span></span></span> where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>L</mi><msup><mi>L</mi><mi mathvariant=normal >⊤</mi></msup><mo>=</mo><mi mathvariant=normal >Σ</mi></mrow><annotation encoding="application/x-tex">LL^\top = \Sigma</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.849108em;vertical-align:0em;"></span><span class="mord mathdefault">L</span><span class=mord ><span class="mord mathdefault">L</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span></span><span class=base ><span class=strut  style="height:0.68333em;vertical-align:0em;"></span><span class=mord >Σ</span></span></span></span>.</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable rowspacing=0.24999999999999992em  columnalign=right  columnspacing=""><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mtext>KL</mtext><mo stretchy=false >(</mo><mi>q</mi><mi mathvariant=normal >∣</mi><mi mathvariant=normal >∣</mi><mi>p</mi><mo stretchy=false >)</mo><mo>=</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo fence=true >[</mo><mi>log</mi><mo>⁡</mo><mi mathvariant=normal >∣</mi><mi>K</mi><mi mathvariant=normal >∣</mi><mo>−</mo><mn>2</mn><mi>log</mi><mo>⁡</mo><mi mathvariant=normal >∣</mi><mi>L</mi><mi mathvariant=normal >∣</mi><mo>−</mo><mi>d</mi><mo>+</mo><mtext>tr</mtext><mo stretchy=false >(</mo><msup><mi>L</mi><mi mathvariant=normal >⊤</mi></msup><msup><mi>K</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>L</mi><mo stretchy=false >)</mo><mo>+</mo><mo stretchy=false >(</mo><msub><mi>μ</mi><mn>0</mn></msub><mo>−</mo><mi>μ</mi><msup><mo stretchy=false >)</mo><mi>T</mi></msup><msup><mi>K</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >(</mo><msub><mi>μ</mi><mn>0</mn></msub><mo>−</mo><mi>μ</mi><mo stretchy=false >)</mo><mo fence=true >]</mo></mrow><mi mathvariant=normal >.</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} \text{KL}(q||p) = \frac{1}{2}\left[\log|K| - 2 \log|L| - d + \text{tr} (L^\top K^{-1}L) + (\mu_0 - \mu)^T K^{-1}(\mu_0 - \mu)\right]. \end{aligned}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:2.30744em;vertical-align:-0.90372em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.4037200000000003em;"><span style="top:-3.4037200000000003em;"><span class=pstrut  style="height:3.32144em;"></span><span class=mord ><span class="mord text"><span class=mord >KL</span></span><span class=mopen >(</span><span class="mord mathdefault" style="margin-right:0.03588em;">q</span><span class=mord >∣</span><span class=mord >∣</span><span class="mord mathdefault">p</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">[</span></span><span class=mop >lo<span style="margin-right:0.01389em;">g</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >∣</span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class=mord >∣</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >2</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mop >lo<span style="margin-right:0.01389em;">g</span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >∣</span><span class="mord mathdefault">L</span><span class=mord >∣</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">d</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class=mord >tr</span></span><span class=mopen >(</span><span class=mord ><span class="mord mathdefault">L</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8991079999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">⊤</span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">L</span><span class=mclose >)</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mopen >(</span><span class=mord ><span class="mord mathdefault">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">μ</span><span class=mclose ><span class=mclose >)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8913309999999999em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.13889em;">T</span></span></span></span></span></span></span></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mopen >(</span><span class=mord ><span class="mord mathdefault">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault">μ</span><span class=mclose >)</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">]</span></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >.</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.90372em;"><span></span></span></span></span></span></span></span></span></span></span></span> <pre><code class="julia hljs">L = cholesky(Σ).L
KL(μ, L::<span class=hljs-built_in >LowerTriangular</span>, μ₀, K) =
 	<span class=hljs-number >0.5</span>*(logdet(K) - <span class=hljs-number >2</span>logdet(L) - length(μ) +
			tr(L&#x27; * inv(K) * L) + (μ₀ - μ)&#x27; * inv(K) * (μ₀-μ))
<span class=hljs-meta >@show</span> KL(μ,L,μ₀,K)</code></pre> <pre><code class="plaintext hljs">KL(μ, L, μ₀, K) = 252.0629478989614
</code></pre> <h3 id=derivatives_kl_divergence_given_variational_parameters ><a href="#derivatives_kl_divergence_given_variational_parameters">Derivatives KL Divergence given variational parameters</a></h3> <h4 id=gradients ><a href="#gradients">Gradients</a></h4> <p>Gradients given <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo separator=true >,</mo><mi mathvariant=normal >Σ</mi><mo separator=true >,</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">\mu,\Sigma,L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">μ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >Σ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span></span></span></span>:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable rowspacing=0.24999999999999992em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mfrac><mrow><mi>d</mi><mtext>KL</mtext></mrow><mrow><mi>d</mi><mi>μ</mi></mrow></mfrac><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><msup><mi>K</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy=false >(</mo><mi>μ</mi><mo>−</mo><msub><mi>μ</mi><mn>0</mn></msub><mo stretchy=false >)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mfrac><mrow><mi>d</mi><mtext>KL</mtext></mrow><mrow><mi>d</mi><mi mathvariant=normal >Σ</mi></mrow></mfrac><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo fence=true >(</mo><mo>−</mo><msup><mi mathvariant=normal >Σ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><msup><mi>K</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo fence=true >)</mo></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mfrac><mrow><mi>d</mi><mtext>KL</mtext></mrow><mrow><mi>d</mi><mi>L</mi></mrow></mfrac><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mrow><mo fence=true >(</mo><mo>−</mo><mn>2</mn><mtext>diag</mtext><mo stretchy=false >(</mo><mi>L</mi><msup><mo stretchy=false >)</mo><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><mn>2</mn><msup><mi>K</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>L</mi><mo fence=true >)</mo></mrow></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} \frac{d\text{KL}}{d\mu} =&amp; K^{-1}(\mu-\mu_0)\\ \frac{d\text{KL}}{d\Sigma} =&amp; \frac{1}{2}\left(-\Sigma^{-1} + K^{-1}\right)\\ \frac{d\text{KL}}{dL} =&amp; \frac{1}{2}\left(-2\text{diag}(L)^{-1} + 2K^{-1}L\right) \end{aligned}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:7.26676em;vertical-align:-3.3833800000000003em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.88338em;"><span style="top:-5.88338em;"><span class=pstrut  style="height:3.3714399999999998em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord mathdefault">μ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord text"><span class=mord >KL</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span></span></span><span style="top:-3.331499999999999em;"><span class=pstrut  style="height:3.3714399999999998em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class=mord >Σ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord text"><span class=mord >KL</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span></span></span><span style="top:-0.9740599999999996em;"><span class=pstrut  style="height:3.3714399999999998em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.37144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord mathdefault">L</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord text"><span class=mord >KL</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:3.3833800000000003em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:3.88338em;"><span style="top:-5.88338em;"><span class=pstrut  style="height:3.3714399999999998em;"></span><span class=mord ><span class=mord ></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mopen >(</span><span class="mord mathdefault">μ</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathdefault">μ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span><span style="top:-3.331499999999999em;"><span class=pstrut  style="height:3.3714399999999998em;"></span><span class=mord ><span class=mord ></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class=mord >−</span><span class=mord ><span class=mord >Σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span><span style="top:-0.9740599999999996em;"><span class=pstrut  style="height:3.3714399999999998em;"></span><span class=mord ><span class=mord ></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=minner ><span class="mopen delimcenter" style="top:0em;"><span class="delimsizing size1">(</span></span><span class=mord >−</span><span class=mord >2</span><span class="mord text"><span class=mord >diag</span></span><span class=mopen >(</span><span class="mord mathdefault">L</span><span class=mclose ><span class=mclose >)</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord >2</span><span class=mord ><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">L</span><span class="mclose delimcenter" style="top:0em;"><span class="delimsizing size1">)</span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:3.3833800000000003em;"><span></span></span></span></span></span></span></span></span></span></span></span> <pre><code class="julia hljs">dKL_dμ(K, μ, μ₀) = inv(K) * (μ - μ₀) <span class=hljs-comment ># Analytic Formulation</span>
analytic = dKL_dμ(K, μ, μ₀)
autodiff = ForwardDiff.gradient(μ) <span class=hljs-keyword >do</span> x
	KL(x, Σ, μ₀, K)
<span class=hljs-keyword >end</span></code></pre> <p> <img src="/bayesiantribulations/assets/blogposts/gpderivations/code/output/dKLdmu.svg" alt=""></p> <pre><code class="julia hljs">dKL_dΣ(K, Σ) = <span class=hljs-number >0.5</span> * (-inv(Σ) + inv(K))
analytic = dKL_dΣ(K, Σ)
autodiff = ForwardDiff.gradient(Σ) <span class=hljs-keyword >do</span> x
	KL(μ, x, μ₀, K)
<span class=hljs-keyword >end</span></code></pre> <img src="/bayesiantribulations/assets/blogposts/gpderivations/code/output/dKLdSigma.svg" alt=""> <pre><code class="julia hljs">dKL_dL(K, L) =
	<span class=hljs-built_in >LowerTriangular</span>(<span class=hljs-number >0.5</span> * (-<span class=hljs-number >2</span> * inv(<span class=hljs-built_in >Diagonal</span>(<span class=hljs-built_in >Matrix</span>(L))) + <span class=hljs-number >2</span> * inv(K) * L))
analytic = dKL_dL(K, L)
autodiff = ForwardDiff.gradient(L) <span class=hljs-keyword >do</span> x
	KL(μ, x, μ₀, K)
<span class=hljs-keyword >end</span></code></pre> <img src="/bayesiantribulations/assets/blogposts/gpderivations/code/output/dKLdL.svg" alt=""> <h4 id=hessians ><a href="#hessians">Hessians</a></h4> <p>Hessian given <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo separator=true >,</mo><mi mathvariant=normal >Σ</mi><mo separator=true >,</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">\mu,\Sigma,L</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.8777699999999999em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">μ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >Σ</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">L</span></span></span></span>:</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable rowspacing=0.24999999999999992em  columnalign="right left" columnspacing=0em ><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mfrac><mrow><msup><mi>d</mi><mn>2</mn></msup><mi>K</mi><mi>L</mi></mrow><mrow><mi>d</mi><mi>μ</mi><mi>μ</mi></mrow></mfrac><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><msup><mi>K</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mfrac><mrow><msup><mi>d</mi><mn>2</mn></msup><mi>K</mi><mi>L</mi></mrow><mrow><mi>d</mi><mi>μ</mi><mi>d</mi><mi mathvariant=normal >Σ</mi></mrow></mfrac><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mfrac><mrow><msup><mi>d</mi><mn>2</mn></msup><mi>K</mi><mi>L</mi></mrow><mrow><mi>d</mi><mi mathvariant=normal >Σ</mi><mi mathvariant=normal >Σ</mi></mrow></mfrac><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><msup><mi mathvariant=normal >Σ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>⊗</mo><msup><mi mathvariant=normal >Σ</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mfrac><mrow><msup><mi>d</mi><mn>2</mn></msup><mi>K</mi><mi>L</mi></mrow><mrow><mi>d</mi><mi>μ</mi><mi>d</mi><mi>L</mi></mrow></mfrac><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mn>0</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mfrac><mrow><msup><mi>d</mi><mn>2</mn></msup><mi>K</mi><mi>L</mi></mrow><mrow><mi>d</mi><mi>L</mi><mi>L</mi></mrow></mfrac><mo>=</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>−</mo><mtext>diag</mtext><msup><mi>L</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>⊗</mo><msup><mi>L</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><mi>K</mi><mo>⊗</mo><mi>I</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned} \frac{d^2KL}{d\mu\mu} =&amp; K^{-1}\\ \frac{d^2KL}{d\mu d\Sigma} =&amp; 0\\ \frac{d^2KL}{d\Sigma\Sigma} =&amp; \frac{1}{2} \Sigma^{-1}\otimes \Sigma^{-1}\\ \frac{d^2KL}{d\mu dL} =&amp; 0\\ \frac{d^2KL}{dLL} =&amp; - \text{diag} L^{-1}\otimes L^{-1} + K\otimes I \end{aligned}</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:12.968860000000003em;vertical-align:-6.234430000000001em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:6.7344300000000015em;"><span style="top:-8.734430000000001em;"><span class=pstrut  style="height:3.491108em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.491108em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord mathdefault">μ</span><span class="mord mathdefault">μ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathdefault">d</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">L</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span></span></span><span style="top:-6.062882000000001em;"><span class=pstrut  style="height:3.491108em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.491108em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord mathdefault">μ</span><span class="mord mathdefault">d</span><span class=mord >Σ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathdefault">d</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">L</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span></span></span><span style="top:-3.3913340000000005em;"><span class=pstrut  style="height:3.491108em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.491108em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class=mord >Σ</span><span class=mord >Σ</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathdefault">d</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">L</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span></span></span><span style="top:-0.9142260000000009em;"><span class=pstrut  style="height:3.491108em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.491108em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord mathdefault">μ</span><span class="mord mathdefault">d</span><span class="mord mathdefault">L</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathdefault">d</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">L</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span></span></span><span style="top:1.7573220000000003em;"><span class=pstrut  style="height:3.491108em;"></span><span class=mord ><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.491108em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord mathdefault">d</span><span class="mord mathdefault">L</span><span class="mord mathdefault">L</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathdefault">d</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.8141079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class="mord mathdefault">L</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >=</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:6.234430000000001em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:6.7344300000000015em;"><span style="top:-8.734430000000001em;"><span class=pstrut  style="height:3.491108em;"></span><span class=mord ><span class=mord ></span><span class=mord ><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span style="top:-6.062882000000001em;"><span class=pstrut  style="height:3.491108em;"></span><span class=mord ><span class=mord ></span><span class=mord >0</span></span></span><span style="top:-3.3913340000000005em;"><span class=pstrut  style="height:3.491108em;"></span><span class=mord ><span class=mord ></span><span class=mord ><span class="mopen nulldelimiter"></span><span class=mfrac ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:1.32144em;"><span style="top:-2.314em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >2</span></span></span><span style="top:-3.23em;"><span class=pstrut  style="height:3em;"></span><span class=frac-line  style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord >1</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class=mord ><span class=mord >Σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⊗</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class=mord >Σ</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span style="top:-0.9142260000000009em;"><span class=pstrut  style="height:3.491108em;"></span><span class=mord ><span class=mord ></span><span class=mord >0</span></span></span><span style="top:1.7573220000000003em;"><span class=pstrut  style="height:3.491108em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >−</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class=mord >diag</span></span><span class=mord ><span class="mord mathdefault">L</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⊗</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mord ><span class="mord mathdefault">L</span><span class=msupsub ><span class=vlist-t ><span class=vlist-r ><span class=vlist  style="height:0.864108em;"><span style="top:-3.113em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >+</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.07153em;">K</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class=mbin >⊗</span><span class=mspace  style="margin-right:0.2222222222222222em;"></span><span class="mord mathdefault" style="margin-right:0.07847em;">I</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:6.234430000000001em;"><span></span></span></span></span></span></span></span></span></span></span></span> <p>Where <span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⊗</mo></mrow><annotation encoding="application/x-tex">\otimes</annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:0.66666em;vertical-align:-0.08333em;"></span><span class=mord >⊗</span></span></span></span> is the outer-product<br/></p> <pre><code class="julia hljs">d2KL_dμμ(K) = inv(K)
analytic = d2KL_dμμ(K)
autodiff = ForwardDiff.hessian(μ) <span class=hljs-keyword >do</span> x
	KL(x, Σ, μ₀, K)
<span class=hljs-keyword >end</span>
plot(heatmap(analytic,title=<span class=hljs-string >&quot;Analytic&quot;</span>),
		heatmap(autodiff,title=<span class=hljs-string >&quot;AutoDiff&quot;</span>),
		heatmap(analytic-autodiff,title=<span class=hljs-string >&quot;Difference&quot;</span>),</code></pre> <img src="/bayesiantribulations/assets/blogposts/gpderivations/code/output/d2KLdmumu.svg" alt=""> <pre><code class="julia hljs">d2KL_dSS(Σ) = <span class=hljs-number >0.5</span> * kron(inv(Σ), inv(Σ))
analytic = d2KL_dSS(Σ)
autodiff = ForwardDiff.hessian(Σ) <span class=hljs-keyword >do</span> x
	KL(μ, x, μ₀, K)
<span class=hljs-keyword >end</span></code></pre> <img src="/bayesiantribulations/assets/blogposts/gpderivations/code/output/d2KLdSigmaSigma.svg" alt=""> <div class=page-foot > <div class=copyright > &copy; Théo Galy-Fajou. Last modified: November 12, 2020. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a>. </div> </div> </div> </div> <script src="https://utteranc.es/client.js" repo="theogf/bayesiantribulations" issue-term=title  label="[Comments]" theme=github-light  crossorigin=anonymous  async> </script>